<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>登录</title>
    <link href="../css/bootstrap.min.css" rel="stylesheet">
    <link href="../css/MyCss.css" rel="stylesheet">
    <link href="../css/font-awesome.min.css" rel="stylesheet">
    <link href="../css/star-rating.css" rel="stylesheet">
    <script src="../js/jquery-3.3.1.js"></script>
    <script src="../js/jquery.cookie.js"></script>
    <script src="../js/bootstrap.min.js"></script>
    <script src="../js/star-rating.min.js"></script>
    <style>
        .img-display {
            max-width: 100%;
            max-height: 100%;
        }
    </style>
</head>
<body>
<nav style="font-size:20px;text-align: center; top: 0;" id="global_header"></nav>
<script>
    $("#global_header").load("../static/global_header.html")
</script>
<div class="container-fluid" style="margin-top: 50px">
    <div class="row">

        <div class="col-md-3" style="text-align: center"></div>
        <div class="col-md-5 normal-font">
            <div id="content" style="margin-top: 30px">
                <h1 id="objectName"></h1>
                <div id="content-info" style="float: left">
                    <div style="float: left">
                        <div style="width: 200px;height: 200px">
                            <img id="objectImg" class="img-display" src="../image/object_img/RimWorld.jpg">
                        </div>

                        <div id="score">
                            <form>
                                <label for="input_score">评分</label>
                                <input style="display: inline" id="input_score" name="input_score" class="rating"
                                       value="0">
                                <button class="btn btn-default" type="button"
                                        style="background-color:purple; color: white; border: none">提交评分
                                </button>
                            </form>
                            <script>
                                $("#input_score").rating({
                                    min: 0,
                                    max: 5,
                                    step: 0.5,
                                    size: "xxs",
                                    showClear: false,
                                    showCaption: false,
                                })
                            </script>
                        </div>
                    </div>
                    <div id="info" style="margin-left:10px;float: right">
                        <span>发行公司：</span>我发行的
                        <br>
                        <span>发行时间：</span>8102.0.1
                        <br>
                        <span>其他信息：</span>充数的
                        <br>
                        <span id="objectBuy" href="%">进入购买页面</span>
                        <br>
                    </div>
                </div>

                <div style="float: right;border-left: solid purple 1px">
                    <div style="margin-left: 10px">
                        <p>theCircle评分</p>
                        <div>
                            <strong style="font-size: 30px">
                                10.0
                            </strong>
                        </div>
                    </div>
                </div>
            </div>

            <div style="margin-top: 350px" id="brief-introduction">
                <h2>简介</h2>
                <div style=" margin-top:10px; border-top: solid purple 1px">
                    <p class="normal-font">
                        这里是简介balabala
                    </p>
                </div>

            </div>

            <div>

                <h2>用户评论</h2>
                <div class="comment" id = "comment">
                    
                </div>
            </div>

            <div style="margin-top: 50px">
            <form role="form" >
                <div class="form-group">
                    <label>发表评论</label>
                    <textarea class="form-control" rows="4" id="comment_textarea"></textarea>
                    <button class="btn btn-default" type="button"
                            style="background-color:purple; color: white; border: none;margin-top: 10px"
                    onclick="submitComment()">提交
                    </button>
                </div>
            </form>
            </div>


        </div>
        <div class="col-md-3" style="text-align: center"></div>
    </div>

</div>
</body>
<script>
    $(document).ready(function (){
        console.log(sessionStorage.getItem("obj_name"));
        var data={
            obj_id:sessionStorage.getItem("obj_id")
        }

        $("#objectName").append(sessionStorage.getItem("obj_name"));
        $("#objectImg").attr('src',sessionStorage.getItem("obj_img_href"));
        $("#objectBuy").attr('href',sessionStorage.getItem("obj_href"));

        $.ajax({
            type:'POST',
            url:'/object/getObjectComments',
            data:JSON.stringify(data),
            contentType:'application/json; charset=UTF-8',
            success:function(data_return){
                var commentsJson = eval(data_return);
                var len = commentsJson.length;
                for(var i=0;i<len;i++){
                    var comment = $(
                        "<div class=\"comment_details\">"+
                        "<div style=\"float:left;\">"+
                        "<span class=\"comment_name\">用户id:"+commentsJson[i]['com_creator_id']+" </span>  <span style=\"font-size: 14px\">"+commentsJson[i]['com_last_modify_time']+"</span></div>"+
                        "<div class=\"del\">"+
                        "</div> <div class=\"comment_content\" >"+commentsJson[i]['com_details']+"</div>"+
                        "</div>");
                    $("#comment").append(comment);
                }
            }

        })
    })
</script>
<script>
    function submitComment() {
        var text = $('#comment_textarea').val();
        var u_id = sessionStorage.getItem("u_id");
        if(u_id==null){
            alert("请先登录");
            return;
        }
        var data = {
            "u_id": u_id,
            "obj_id":sessionStorage.getItem("obj_id"),
            "text":text,
        };
        $.ajax({
            type: 'POST',
            url: '/object/addComment',
            data: JSON.stringify(data),
            contentType: 'application/json; charset=UTF-8',
            success: function (data_return) {

                var code_return = data_return["code"];
                if (code_return == 200) {
                    $('#comment_textarea').clear();
                    console.log("add comment success");
                } else {
                    alert("系统出错");
                }
            }
        });
    }
</script>
</html>